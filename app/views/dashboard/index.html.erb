
<div>
  <div>
    <div class="flex flex-wrap gap-4 mb-6">
      <%= form_with url: root_path, method: :get, local: true do |form| %>
        <div class="flex gap-2">
          <%= form.label :status %>
          <%= form.select :status, [ 'pending', 'completed'], { prompt: 'All' }, class: "form-select capitalize" %>
          <%= form.submit "Filter", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
    <div class="modal fade" id="completeModal" tabindex="-1" aria-labelledby="completeModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="completeModalLabel">Mark Task as Completed</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
           <%= form_with url: "", method: :patch, local: true do |form| %>
            <%= form.hidden_field :authenticity_token, value: form_authenticity_token %>
            <%= form.hidden_field :id, id: "task-id" %>
            <div class="modal-body">
              Are you sure you want to mark this task as completed?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <%= form.submit "Mark as Completed", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <div class="mt-4">
      <% @employees.each do |emp| %>
        <div class="mb-6 p-4 border rounded-lg shadow-sm">
          <% if emp.is_a?(Employee) %>
            <h3 class="text-xl font-semibold mb-2"><%= emp.name %> - <%= emp.department %></h3>
            <ul>
              <% if emp.onboarding_tasks.any? %>
                <% emp.onboarding_tasks.each do |task| %>
                  <li class="flex items-center justify-between py-2 border-b">
                    <span><%= task.task_name %> - <span class="<%= task.status == 'completed' ? 'text-green-500' : 'text-yellow-500' %>"><%= task.status.capitalize %></span></span>
                    <% if task.status == 'pending' %>
                      <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#completeModal" data-task-id="<%= task.id %>">
                        Mark as Completed
                      </button>
                    <% end %>
                  </li>
                <% end %>
              <% else %>
                <p>No tasks assigned.</p>
              <% end %>
            </ul>
          <% else %>
            <h3 class="text-xl font-semibold mb-2"><%= emp.email_address %></h3>
            <% if emp.employee && emp.employee.onboarding_tasks.any? %>
              <ul>
                <% emp.employee.onboarding_tasks.each do |task| %>
                  <li class="flex items-center justify-between py-2 border-b">
                    <span><%= task.task_name %> - <span class="<%= task.status == 'completed' ? 'text-green-500' : 'text-yellow-500' %>"><%= task.status.capitalize %></span></span>
                    <% if task.status == 'pending' %>
                      <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#completeModal" data-task-id="<%= task.id %>">
                        Mark as Completed
                      </button>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <p>No tasks assigned.</p>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var completeModal = document.getElementById('completeModal')
        if (completeModal) {
          completeModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget
            var taskId = button.getAttribute('data-task-id')
            var modalForm = completeModal.querySelector('form')
            modalForm.action = '/onboarding_tasks/' + taskId
            var taskIdInput = modalForm.querySelector('#task-id')
            taskIdInput.value = taskId
          })
        }
      })
    </script>
  </div>
